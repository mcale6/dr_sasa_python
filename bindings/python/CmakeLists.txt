cmake_minimum_required(VERSION 3.10)
project(dr_sasa_python_bindings)

# Python Configuration
find_package(Python COMPONENTS Interpreter Development REQUIRED)
find_package(pybind11 CONFIG REQUIRED)

# Create Python module
pybind11_add_module(dr_sasa_py 
    bindings.cpp
)

# Include directories
target_include_directories(dr_sasa_py PRIVATE 
    ${CMAKE_SOURCE_DIR}/dr_sasa_n/src
    ${CMAKE_SOURCE_DIR}/dr_sasa_n/include
)

# Link with core library and dependencies
target_link_libraries(dr_sasa_py PRIVATE 
    dr_sasa_core
)

if(USE_CUDA)
    target_link_libraries(dr_sasa_py PRIVATE ${CUDA_LIBRARIES})
endif()

# Installation configuration
if(SKBUILD)
    install(TARGETS dr_sasa_py DESTINATION .)
else()
    install(TARGETS dr_sasa_py 
            LIBRARY DESTINATION ${Python_SITEARCH}
            RUNTIME DESTINATION ${Python_SITEARCH})
endif()

# Install data files
install(FILES 
    ${CMAKE_SOURCE_DIR}/dr_sasa_n/doc/vdw.radii
    ${CMAKE_SOURCE_DIR}/dr_sasa_n/utils/points/thomson15092.xyz
    DESTINATION ${Python_SITEARCH}/dr_sasa_data
)

# Add OpenCL kernel files if they exist
if(EXISTS ${CMAKE_SOURCE_DIR}/dr_sasa_n/src/kernels)
    install(DIRECTORY ${CMAKE_SOURCE_DIR}/dr_sasa_n/src/kernels
            DESTINATION ${Python_SITEARCH}/dr_sasa_data)
endif()